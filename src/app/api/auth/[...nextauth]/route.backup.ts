// Backup of the original route.ts file
// This is the complex version with extensive error handling